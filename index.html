<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GV Residency - Team Entry Portal</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f0f2f5; padding: 20px; }
        .sheet-container { background: white; border: 1px solid #ccc; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 700px; margin: auto; border-radius: 8px; overflow: hidden; }
        table { border-collapse: collapse; width: 100%; }
        td { border: 1px solid #dfe3e8; padding: 12px; font-size: 14px; }
        .label-cell { background-color: #f8f9fa; font-weight: bold; width: 40%; color: #333; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; box-sizing: border-box; }
        select[multiple] { height: 100px; background-color: #fff; }
        .hidden { display: none; }
        .button-group { padding: 20px; text-align: center; background: #f8f9fa; border-top: 1px solid #ddd; }
        button { padding: 10px 25px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-submit { background-color: #28a745; color: white; }
        .btn-reset { background-color: #007bff; color: white; }
        .status-tag { padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; }
        .locked { background: #f8d7da; color: #721c24; }
        .unlocked { background: #d4edda; color: #155724; }
        .draft-alert { background: #fff3cd; color: #856404; padding: 10px; text-align: center; font-size: 13px; display: none; border-bottom: 1px solid #ffeeba; }
    </style>
</head>
<body>

    <h2 style="text-align: center;">GV Residency Team Portal</h2>

    <div id="draftMessage" class="draft-alert">⚠️ Draft restored from your previous session.</div>

    <form id="residencyForm">
        <div class="sheet-container">
            <table>
                <tr>
                    <td class="label-cell">Name</td>
                    <td>
                        <select id="name" name="MemberName" required>
                            <option value="">-- Select Member --</option>
                            <option value="Arun">Arun</option><option value="Senthil">Senthil</option>
                            <option value="Udhay">Udhay</option><option value="Saranya">Saranya</option>
                            <option value="Jayanthi">Jayanthi</option><option value="Appa">Appa</option>
                            <option value="Others">Others</option>
                        </select>
                    </td>
                </tr>
                <tr><td class="label-cell">Date</td><td><input type="date" name="Date" required></td></tr>
                <tr>
                    <td class="label-cell" style="background-color: #fff3cd;">Password</td>
                    <td><input type="password" id="passInput" placeholder="Enter password to unlock"></td>
                </tr>
                <tr><td class="label-cell">Status</td><td><span id="statusLabel" class="status-tag locked">Locked</span></td></tr>

                <tbody id="protectedContent" class="hidden">
                    <tr>
                        <td class="label-cell">Entry Type</td>
                        <td>
                            <select id="B6" name="EntryType" onchange="updateB7()">
                                <option value="">-- Select Type --</option>
                                <option value="Expenses">Expenses</option>
                                <option value="Income">Income</option>
                                <option value="Adjustment">Adjustment</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="label-cell">Select Transaction</td>
                        <td><select id="B7" name="Transaction"><option value="">Select Entry Type first</option></select></td>
                    </tr>
                    <tr><td class="label-cell">Date of Entry</td><td><input type="date" name="EntryDate"></td></tr>
                    <tr><td class="label-cell">Amount</td><td><input type="number" name="Amount" placeholder="0.00"></td></tr>
                    <tr>
                        <td class="label-cell">Location</td>
                        <td>
                            <select name="SourceLocation">
                                <option>Thavalam</option><option>Chinniampalayam</option><option>Odapatti</option><option>GV Residency</option><option>Others</option>
                            </select>
                        </td>
                    </tr>
                    <tr><td class="label-cell">Remark</td><td><textarea name="Remark" rows="2"></textarea></td></tr>
                    <tr>
                        <td class="label-cell">Transaction By</td>
                        <td>
                            <select name="PaymentMethod">
                                <option>Cash</option><option>UPI</option><option>Bank Transfer</option><option>Cheque</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="label-cell">To be Shared (Multi)</td>
                        <td>
                            <select multiple name="SharedWith">
                                <option>Arun</option><option>Senthil</option><option>Udhay</option>
                                <option>Saranya</option><option>Jayanthi</option><option>Appa</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="label-cell">To be Divided (Multi)</td>
                        <td>
                            <select multiple name="DividedAmong">
                                <option>Arun</option><option>Senthil</option><option>Udhay</option>
                                <option>Saranya</option><option>Jayanthi</option><option>Appa</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="label-cell">Paid Back To</td>
                        <td><select name="PaidBackTo"><option value="N/A">N/A</option><option>Arun</option><option>Senthil</option><option>Udhay</option></select></td>
                    </tr>
                    <tr>
                        <td class="label-cell">Income Received From</td>
                        <td><select name="ReceivedFrom"><option value="N/A">N/A</option><option>Arun</option><option>Senthil</option><option>Udhay</option></select></td>
                    </tr>
                    <tr><td class="label-cell">Query Details</td><td><input type="text" name="Queries"></td></tr>
                    <tr>
                        <td class="label-cell">Income Received By</td>
                        <td><select name="ReceivedBy"><option value="N/A">N/A</option><option>Arun</option><option>Senthil</option><option>Udhay</option></select></td>
                    </tr>
                </tbody>
            </table>
            <div class="button-group hidden" id="formButtons">
                <button type="submit" class="btn-submit">Submit Record</button>
                <button type="button" class="btn-reset" onclick="resetForm()">Fill Another</button>
            </div>
        </div>
    </form>

    <script>
        /** * SECURITY & CONFIG DATA (OBFUSCATED)
         * [0] = Password, [1] = Google Apps Script URL
         */
        var _0x92f1=["\x59\x75\x6b\x54\x69\x4b\x61\x40\x31\x32\x33","\x68\x74\x74\x70\x73\x3a\x2f\x2f\x73\x63\x72\x69\x70\x74\x2e\x67\x6f\x6f\x67\x6c\x65\x2e\x63\x6f\x6d\x2f\x6d\x61\x63\x72\x6f\x73\x2f\x73\x2f\x41\x4b\x66\x79\x63\x62\x7a\x65\x51\x4d\x50\x67\x59\x32\x56\x58\x2d\x53\x70\x4f\x6b\x56\x49\x43\x31\x78\x31\x32\x6d\x70\x4d\x33\x77\x7a\x75\x6d\x50\x74\x64\x46\x54\x46\x5f\x58\x42\x6a\x52\x59\x68\x6a\x34\x52\x53\x62\x7a\x64\x76\x39\x6a\x57\x61\x6a\x72\x63\x5a\x47\x6e\x2d\x70\x54\x36\x7a\x2f\x65\x78\x65\x63"];
        const scriptURL = _0x92f1[1];
        const passKey = _0x92f1[0];

        const form = document.getElementById('residencyForm');

        // --- PASSWORD CHECK ---
        document.getElementById('passInput').addEventListener('input', function() {
            const isMatch = this.value === passKey;
            document.getElementById('protectedContent').classList.toggle('hidden', !isMatch);
            document.getElementById('formButtons').classList.toggle('hidden', !isMatch);
            document.getElementById('statusLabel').innerText = isMatch ? "Unlocked" : "Locked";
            document.getElementById('statusLabel').className = "status-tag " + (isMatch ? "unlocked" : "locked");
        });

        const criteria = {
            "Expenses": ["House Maintenance", "Labour Charges", "Agri-Materials", "Transportation", "EB-Bill", "Advance-Refund", "Others"],
            "Income": ["Rent", "Agri-Product", "House Advance", "Loan"],
            "Adjustment": ["Paying Back", "Divided Between"]
        };

        function updateB7() {
            const b6 = document.getElementById('B6').value;
            const b7 = document.getElementById('B7');
            b7.innerHTML = criteria[b6] ? criteria[b6].map(i => `<option value="${i}">${i}</option>`).join('') : '<option>Select Type first</option>';
        }

        // --- AUTO-SAVE DRAFT LOGIC ---
        form.addEventListener('change', () => {
            const formData = new FormData(form);
            const obj = {};
            formData.forEach((value, key) => {
                if(!obj[key]) { obj[key] = value; return; }
                if(!Array.isArray(obj[key])) { obj[key] = [obj[key]]; }
                obj[key].push(value);
            });
            localStorage.setItem('gv_draft', JSON.stringify(obj));
        });

        window.onload = () => {
            const saved = localStorage.getItem('gv_draft');
            if(saved) {
                const data = JSON.parse(saved);
                for(let key in data) {
                    let el = form.elements[key];
                    if(el) el.value = data[key];
                }
                updateB7();
                document.getElementById('draftMessage').style.display = 'block';
            }
        };

        // --- SUBMIT TO GOOGLE SHEET ---
        form.onsubmit = function(e) {
            e.preventDefault();
            const btn = document.querySelector('.btn-submit');
            btn.innerText = "Saving to Database..."; btn.disabled = true;

            fetch(scriptURL, { method: 'POST', body: new FormData(form)})
            .then(() => {
                alert("Success! The record has been added to the sheet.");
                localStorage.removeItem('gv_draft');
                resetForm();
            })
            .catch(() => alert("Submission Failed. Check your network. Data is still saved as a draft on this device."))
            .finally(() => {
                btn.innerText = "Submit Record";
                btn.disabled = false;
            });
        };

        function resetForm() {
            form.reset();
            updateB7();
            localStorage.removeItem('gv_draft');
            document.getElementById('protectedContent').classList.add('hidden');
            document.getElementById('formButtons').classList.add('hidden');
            document.getElementById('statusLabel').innerText = "Locked";
            document.getElementById('statusLabel').className = "status-tag locked";
            document.getElementById('draftMessage').style.display = 'none';
            window.scrollTo(0, 0);
        }
    </script>
</body>
</html>

